10 REM GAME
10 GOTO 1000

20 REM GAME LOGIC
20 I=(X+4)\8:J=Y\128+(Y<0):IF J<-2 OR VY<0 GOTO 50
30 IF VY>0 GOTO 40 ELSE IF PL(J+2,I)>0 OR PL(J+2,I+1)>0 GOTO 60
40 K=(Y+VY)\128:IF K=J GOTO 50 ELSE IF PL(K+2,I)>0 OR PL(K+2,I+1)>0 THEN VY=0:F=0:Y=K*128:GOTO 60 
50 Y=Y+VY:VY=VY+AC

60 ON STICK(0)+1 GOTO 110,110,70,70,70,110,90,90,90
70 X=X+2+(VY<>0):IF X>240 THEN X=240
80 _SGAM(X,Y\16,2,PG,2,AR):GOTO 120
90 X=X-2-(VY<>0):IF X<0 THEN X=0
100 _SGAM(X,Y\16,2,PG,2,AL):GOTO 120
110 _SPRGRPMOV(X,Y\16,2,PG):SU=1

120 _COLL(A,X+4,Y\16,7,15,11,CD):IF A=-1 GOTO 20
130 REM FIRST 5 OBJECTS ARE KEYS, REST ARE CRITTERS
130 IF A>=5 GOTO 140 ELSE CD(0,A)=0:_ANIMSTOP(24+A):SA(0,14+A)=256:SA(0,19+A)=256:_SNDSFX(4,2,0):GOTO 20
140 COLOR ,,INT(RND(1)*15)+1:_SNDSFX(5,2,0):GOTO 20

500 REM STRIG(0) SUBROUTINE
500 IF F=0 THEN F=1:VY=-55:_SNDSFX(2,2,0)
510 RETURN

700 REM ERROR AND CTRL-STOP HANDLER
700 FOR I=24 TO 31:_ANIMSTOP(I):NEXT
710 FOR I=0 TO 5:_AUTOSGAMSTOP(I):NEXT
720 _SPRDISABLE:_SNDPLYOFF
730 SCREEN 0:END

1000 _SPRDISABLE:DEFINT A-Z
1001 PRINT "Loading music"
1002 BLOAD "GAMEMUS.BIN", &HC000:_MEMCPY(&HC000,&H100,1608)
1003 PRINT "Loading SFX"
1004 BLOAD "SFX.BIN":_MEMCPY(&HC007,&H1000,218)
1005 _SNDPLYINI(&H100,&H1000)
1010 PRINT "Loading graphics elements"
1011 BLOAD"KNIGHT2.BIN",&HC000:_MEMCPY(&HC000,&H1100,2*11*10*8)
1019 PRINT "Initializing data"
1020 A=0:I=0:J=0:K=0:O=0:EX=0:EY=0
1030 REM BASIC SPRITE SUBSYSTEM VARIABLES
1030 SU=0:DIM SA(3,31):DIM AD(14):_FILRAM(VARPTR(SA(0,0)),256,1)
1040 REM PLAYER VARIABLES
1040 DIM PG(2,1):DIM AR(1):DIM AL(1):X=0:Y=0:VY=0:AC=0:F=0
1050 REM FOX 1 VARIABLES
1050 FX=0:FY=0:DIM FG(2,1):DIM FR(1):DIM FL(1)
1060 REM FOX 2 VARIABLES
1060 GX=0:GY=0:DIM GG(2,1):DIM GR(1):DIM GL(1)
1070 REM SNAKE 1 VARIABLES
1070 SX=0:SY=0:DIM SG(2,1):DIM SR(1):DIM SL(1)
1080 REM SNAKE 2 VARIABLES
1080 TX=0:TY=0:DIM TG(2,1):DIM TR(1):DIM TL(1)
1090 REM BAT 1 VARIABLES
1090 BX=0:BY=0:DIM BG(2,1):DIM BU(1)
1100 REM BAT 2 VARIABLES
1100 CX=0:CY=0:DIM CG(2,1):DIM CU(1)
1110 REM PLATFORM LOCATIONS
1110 DIM PL(24,31)
1120 REM COLLISION DETECTION
1120 DIM CD(7,10)
1130 _MAXAUTOSGAMS(0):_MAXANIMSPRS(0):_MAXANIMDEFS(0):_MAXANIMITEMS(0)
1140 _MAXANIMITEMS(54):_MAXANIMDEFS(16):_MAXANIMSPRS(32):_MAXAUTOSGAMS(6)

1490 REM PLATFORM
1490 RESTORE 30000:FOR I=0 TO 15:READ A:POKE &HC800+I,A:NEXT:_MEMCPY(&HC800,&H7000,16)
1560 REM DEFINE SPRITE GROUP FOR PLAYER
1560 PG(0,0)=0:PG(1,0)=0:PG(2,0)=0
1570 PG(0,1)=1:PG(1,1)=0:PG(2,1)=0
1590 REM DEFINE SPRITE GROUP FOR FOX 1
1590 FG(0,0)=2:FG(1,0)=0:FG(2,0)=0:FG(0,1)=3:FG(1,1)=0:FG(2,1)=0
1591 REM DEFINE SPRITE GROUP FOR FOX 2
1591 GG(0,0)=4:GG(1,0)=0:GG(2,0)=0:GG(0,1)=5:GG(1,1)=0:GG(2,1)=0
1592 REM DEFINE SPRITE GROUP FOR SNAKE 1
1592 SG(0,0)=6:SG(1,0)=0:SG(2,0)=0:SG(0,1)=7:SG(1,1)=0:SG(2,1)=0
1593 REM DEFINE SPRITE GROUP FOR SNAKE 2
1593 TG(0,0)=8:TG(1,0)=0:TG(2,0)=0:TG(0,1)=9:TG(1,1)=0:TG(2,1)=0
1594 REM DEFINE SPRITE GROUP FOR BAT 1
1594 BG(0,0)=10:BG(1,0)=0:BG(2,0)=0:BG(0,1)=11:BG(1,1)=0:BG(2,1)=0
1595 REM DEFINE SPRITE GROUP FOR BAT 2
1595 CG(0,0)=12:CG(1,0)=0:CG(2,0)=0:CG(0,1)=13:CG(1,1)=0:CG(2,1)=0
1600 REM DEFINE ANIMATION ITEMS - PATTERN AND COLOR CHANGES FOR SPRITES
1600 RESTORE 50000:READ A:FOR I=0 TO A-1:FOR J=0 TO 2:READ AD(J):NEXT J:_ANIMITEMPAT(I,AD(0),AD(1),AD(2)):NEXT I
1605 REM DEFINE ANIMATION ITEMS - PATTERN DEFINITION CHANGES
1605 READ K:FOR I=A TO A+K-1:FOR J=0 TO 1:READ AD(J):NEXT J:_ANIMITEMPTR(I,AD(0),AD(1)):NEXT I
1610 REM DEFINE ANIMATIONS
1610 READ A:FOR I=0 TO A-1:READ K:FOR J=0 TO K-1:READ AD(J):NEXT J:_ANIMDEF(I,K,AD):NEXT I
1620 REM DEFINE SPRITE ANIMATIONS
1620 READ A:FOR I=0 TO A-1:FOR J=0 TO 2:READ AD(J):NEXT J:_ANIMSPRITE(I,AD(0),AD(1),AD(2)):NEXT I
1630 REM DEFINE CHARACTER ANIMATIONS
1630 READ K:FOR I=A TO A+K-1:FOR J=0 TO 2:READ AD(J):NEXT J:_ANIMCHAR(I,AD(0),AD(1),AD(2)):NEXT I
1980 FOR I=0 TO 31:SA (0,I)=256:PL(24,I)=1:NEXT
1990 FX=200:FY=176:GX=112:GY=56:SX=56:SY=25:TX=96:TY=105:BX=40:BY=0:CX=220:CY=120
2000 X=120:Y=120*16:AC=4:VY=0
2010 REM INITIAL PATTERNS AND COLORS OF PLAYER SPRITES
2010 SA(2,0)=0:SA(3,0)=1
2011 SA(2,1)=1:SA(3,1)=15
2014 REM INITIAL PATTERNS AND COLORS OF FOX 1
2014 SA(2,2)=12:SA(3,2)=1
2015 SA(2,3)=15:SA(3,3)=11
2016 REM INITIAL PATTERNS AND COLORS OF FOX 2
2016 SA(2,4)=12:SA(3,4)=1
2017 SA(2,5)=15:SA(3,5)=11
2018 REM INITIAL PATTERNS AND COLORS OF SNAKE 1
2018 SA(2,6)=24:SA(3,6)=1
2019 SA(2,7)=25:SA(3,7)=13
2020 REM INITIAL PATTERNS AND COLORS OF SNAKE 2
2020 SA(2,8)=24:SA(3,8)=1
2021 SA(2,9)=25:SA(3,9)=13
2022 REM INITIAL PATTERNS AND COLORS OF BAT 1
2022 SA(2,10)=32:SA(3,10)=1
2023 SA(2,11)=33:SA(3,11)=4
2024 REM INITIAL PATTERNS AND COLORS OF BAT 2
2024 SA(2,12)=32:SA(3,12)=1
2025 SA(2,13)=33:SA(3,13)=4
2026 REM INITIAL SETUP FOR KEY 1
2026 SA(0,14)=176:SA(1,14)=172:SA(2,14)=39:SA(3,14)=15
2027 SA(0,19)=176:SA(1,19)=172:SA(2,19)=38:SA(3,19)=1
2028 REM INITIAL SETUP FOR KEY 2
2028 SA(0,15)=4:SA(1,15)=4:SA(2,15)=39:SA(3,15)=15
2029 SA(0,20)=4:SA(1,20)=4:SA(2,20)=38:SA(3,20)=1
2030 REM INITIAL SETUP FOR KEY 3
2030 SA(0,16)=42:SA(1,16)=240:SA(2,16)=39:SA(3,16)=15
2031 SA(0,21)=42:SA(1,21)=240:SA(2,21)=38:SA(3,21)=1
2032 REM INITIAL SETUP FOR KEY 4
2032 SA(0,17)=96:SA(1,17)=40:SA(2,17)=39:SA(3,17)=15
2033 SA(0,22)=96:SA(1,22)=40:SA(2,22)=38:SA(3,22)=1
2034 REM INITIAL SETUP FOR KEY 5
2034 SA(0,18)=130:SA(1,18)=100:SA(2,18)=39:SA(3,18)=15
2035 SA(0,23)=130:SA(1,23)=100:SA(2,23)=38:SA(3,23)=1
2040 REM COLLISION DETECTION SETUP
2040 REM ACTIVE FLAG, UPPER LEFT X / SPRITE ID, UPPER LEFT Y / NOT USED
2040 REM START OFFSET X, START OFFSET Y, WIDTH, HEIGHT, TYPE 0=GENERIC / <>0 = SPRITE
2040 CD(0,0)=1:CD(1,0)=14:CD(3,0)=0:CD(4,0)=0:CD(5,0)=13:CD(6,0)=12:CD(7,0)=1
2041 CD(0,1)=1:CD(1,1)=15:CD(3,1)=0:CD(4,1)=0:CD(5,1)=13:CD(6,1)=12:CD(7,1)=1
2042 CD(0,2)=1:CD(1,2)=16:CD(3,2)=0:CD(4,2)=0:CD(5,2)=13:CD(6,2)=12:CD(7,2)=1
2043 CD(0,3)=1:CD(1,3)=17:CD(3,3)=0:CD(4,3)=0:CD(5,3)=13:CD(6,3)=12:CD(7,3)=1
2044 CD(0,4)=1:CD(1,4)=18:CD(3,4)=0:CD(4,4)=0:CD(5,4)=13:CD(6,4)=12:CD(7,4)=1
2050 REM CRITTERS
2050 REM FOXES
2050 CD(0,5)=1:CD(1,5)=2:CD(3,5)=0:CD(4,5)=8:CD(5,5)=15:CD(6,5)=7:CD(7,5)=1
2051 CD(0,6)=1:CD(1,6)=4:CD(3,6)=0:CD(4,6)=8:CD(5,6)=15:CD(6,6)=7:CD(7,6)=1
2052 REM SNAKES
2052 CD(0,7)=1:CD(1,7)=6:CD(3,7)=0:CD(4,7)=6:CD(5,7)=15:CD(6,7)=8:CD(7,7)=1
2053 CD(0,8)=1:CD(1,8)=8:CD(3,8)=0:CD(4,8)=6:CD(5,8)=15:CD(6,8)=8:CD(7,8)=1
2054 REM BATS
2054 CD(0,9)=1:CD(1,9)=10:CD(3,9)=0:CD(4,9)=2:CD(5,9)=14:CD(6,9)=14:CD(7,9)=1
2055 CD(0,10)=1:CD(1,10)=12:CD(3,10)=0:CD(4,10)=2:CD(5,10)=14:CD(6,10)=14:CD(7,10)=1

2130 REM ANIMATION GROUPS
2130 REM PLAYER 
2130 AR(0)=0:AR(1)=1:AL(0)=2:AL(1)=3
2140 REM FOX 1
2140 FR(0)=4:FR(1)=5:FL(0)=6:FL(1)=7
2150 REM FOX 2
2150 GR(0)=8:GR(1)=9:GL(0)=10:GL(1)=11
2160 REM SNAKE 1
2160 SR(0)=12:SR(1)=13:SL(0)=14:SL(1)=15
2170 REM SNAKE 2
2170 TR(0)=16:TR(1)=17:TL(0)=18:TL(1)=19
2180 REM BAT 1
2180 BU(0)=20:BU(1)=21
2190 REM BAT 2
2190 CU(0)=22:CU(1)=23

2200 REM AUTO SPRITE GROUP ANIMATE AND MOVE
2200 REM ID, X LOCATION VARIABLE, Y LOCATION VARIABLE
2200 REM MINIMUM, MAXIMUM, DELTA, DIRECTION (0=X, <>0 Y)
2200 REM TICKS BETWEEN CHANGE, SPRITE GROUP SIZE, SPRITE GROUP ARRAY
2200 REM ANIMATION LIST SIZE, ANIMATION LIST FOR NEGATIVE DIRECTION, ANIMATION LIST FOR POSITIVE DIRECTION
2200 _AUTOSGAMDEF(0,FX,FY,0,240,1,0,3,2,FG,2,FL,FR):_AUTOSGAMDEF(1,GX,GY,112,144,1,0,5,2,GG,2,GL,GR)
2210 _AUTOSGAMDEF(2,SX,SY,56,96,1,0,5,2,SG,2,SL,SR):_AUTOSGAMDEF(3,TX,TY,96,128,1,0,5,2,TG,2,TL,TR)
2220 _AUTOSGAMDEF(4,BX,BY,0,136,1,1,3,2,BG,2,BU,BU):_AUTOSGAMDEF(5,CX,CY,0,160,1,1,3,2,CG,2,CU,CU)

2250 ON STOP GOSUB 700:STOP ON
2260 ON ERROR GOTO 700

2370 PRINT "Loading platform data"
2380 BLOAD"LEVEL.BIN":_MEMCPY(&HC800,VARPTR(PL(0,0)),1600)
2390 COLOR 15,1,1:SCREEN 2,2,0
2400 BLOAD"LVL.SC2",S
2410 REM SAVE SCREEN DATA, DRAW KNIGHT AND COPY TO SCREEN
2420 _VRMMEM(BASE(12),&H2000,6144)
2430 _BLIT(20,91,&H1100,&H1470,10,11,&H2000,32,24)
2440 _MEMVRM(&H2000,BASE(12),6144,0)
2450 _SPRENABLE (SA,SU,1)
2460 REM KEY AND PLATFORM ANIMATIONS
2460 FOR I=24 TO 31:_ANIMSTART(I):NEXT

2500 REM DISPLAY ALL SPRITES MANUALLY
2500 _SPRGRPMOV(X,Y\16,2,PG):_SPRGRPMOV(FX,FY,2,FG):_SPRGRPMOV(GX,GY,2,GG):_SPRGRPMOV(SX,SY,2,SG):_SPRGRPMOV(TX,TY,2,TG)::_SPRGRPMOV(BX,BY,2,BG):_SPRGRPMOV(CX,CY,2,CG):SU=1

2540 FOR I=0 TO 5:_AUTOSGAMSTART(I):NEXT
2550 ON STRIG GOSUB 500:STRIG(0) ON
2560 REM INIT DONE
2560 _SNDPLYON:GOTO 20

30000 REM PLATFORM ANIMATION DEFINITION
30000 DATA &H66,&HCC,&H99,&H33,&H66,&HCC,&H99,&H33
30010 DATA &H99,&H33,&H66,&HCC,&H99,&H33,&H66,&HCC

50000 REM PATTERN AND COLOR CHANGE ANIMATIONS - NUMBER
50000 DATA 52
50010 REM ANIMATION - DEFINITIONS (DURATION, PATTERN, COLOR)
50010 REM PLAYER RIGHT DIRECTION FIRST
50010 REM BLACK
50010 DATA 3,0,1,3,2,1,3,4,1
50030 REM WHITE
50030 DATA 3,1,15,3,3,15,3,5,15
50040 REM PLAYER LEFT DIRECTION
50040 REM BLACK
50040 DATA 3,6,1,3,8,1,3,10,1
50060 REM WHITE
50060 DATA 3,7,15,3,9,15,3,11,15
50080 REM FOX - RIGHT
50080 REM BLACK
50080 DATA 2,12,1,2,14,1,2,16,1
50100 REM YELLOW
50100 DATA 2,13,11,2,15,11,2,17,11
50110 REM FOX - LEFT
50110 REM BLACK
50110 DATA 2,18,1,2,20,1,2,22,1
50120 REM YELLOW
50120 DATA 2,19,11,2,21,11,2,23,11
50130 REM SNAKE - RIGHT
50130 REM BLACK
50130 DATA 2,24,1,2,26,1
50140 REM MAGENTA
50140 DATA 2,25,13,2,27,13
50150 REM SNAKE - LEFT
50150 REM BLACK
50150 DATA 2,28,1,2,30,1
50160 REM MAGENTA
50160 DATA 2,29,13,2,31,13
50170 REM BAT
50170 REM BLACK
50170 DATA 2,32,1,2,34,1,2,36,1
50180 REM BLUE
50180 DATA 2,33,4,2,35,4,2,37,4
50190 REM KEY
50190 DATA 5,39,2,5,39,3,5,39,4,5,39,5,5,39,6,5,39,7,5,39,8,5,39,9,5,39,10,5,39,11,5,39,12,5,39,13,5,39,14,5,39,15

50500 REM PATTERN DEFINITION CHANGE ANIMATIONS - NUMBER
50500 DATA 2
50510 REM ANIMATION - DEFINITONS (DURATION, POINTER)
50510 REM PLATFORM
50510 DATA 10,&H7000,10,&H7008

51000 REM ANIMATION DEFINITIONS (SIZE,ANIMATION ITEMS,...)
51000 REM TOTAL NUMBER
51000 DATA 16
51010 REM 0 PLAYER - RIGHT BLACK
51010 DATA 4,0,1,2,1
51030 REM 1 PLAYER - RIGHT WHITE
51030 DATA 4,3,4,5,4
51040 REM 2 PLAYER - LEFT BLACK
51040 DATA 4,6,7,8,7
51060 REM 3 PLAYER - LEFT WHITE
51060 DATA 4,9,10,11,10
51080 REM 4 FOX - RIGHT BLACK
51080 DATA 4,12,13,14,13
51090 REM 5 FOX - RIGHT YELLOW
51090 DATA 4,15,16,17,16
51100 REM 6 FOX - LEFT BLACK
51100 DATA 4,18,19,20,19
51110 REM 7 FOX - LEFT YELLOW
51110 DATA 4,21,22,23,22
51120 REM 8 SNAKE - RIGHT BLACK
51120 DATA 2,24,25
51130 REM 9 SNAKE - RIGHT MAGENTA
51130 DATA 2,26,27
51140 REM 10 SNAKE - LEFT BLACK
51140 DATA 2,28,29
51150 REM 11 SNAKE - LEFT MAGENTA
51150 DATA 2,30,31
51160 REM 12 BAT - BLACK
51160 DATA 4,32,33,34,33
51170 REM 13 BAT - BLUE
51170 DATA 4,35,36,37,36
51180 REM 14 KEY
51180 DATA 14,38,39,40,41,42,43,44,45,46,47,48,49,50,51
51190 REM 15 PLATFORM
51190 DATA 2,52,53

52000 REM SPRITE ANIMATIONS (SPRITE NUMBER, ANIMATION DEFINITION, CYCLIC FLAG)
52000 REM TOTAL NUMBER
52000 DATA 29
52010 REM PLAYER ANIMATION
52010 REM 0 SPRITE ANIMATION RIGHT BLACK
52010 DATA 0,0,1
52030 REM 1 SPRITE ANIMATION RIGHT WHITE
52030 DATA 1,1,1
52040 REM 2 SPRITE ANIMATION LEFT BLACK
52040 DATA 0,2,1
52060 REM 3 SPRITE ANIMATION LEFT WHITE
52060 DATA 1,3,1
52080 REM FOX 1 ANIMATION
52080 REM 4 SPRITE ANIMATION RIGHT BLACK
52080 DATA 2,4,1
52090 REM 5 SPRITE ANIMATION RIGHT YELLOW
52090 DATA 3,5,1
52100 REM 6 SPRITE ANIMATION LEFT BLACK
52100 DATA 2,6,1
52110 REM 7 SPRITE ANIMATION LEFT YELLOW
52110 DATA 3,7,1
52120 REM FOX 2 ANIMATION
52120 REM 8 SPRITE ANIMATION RIGHT BLACK
52120 DATA 4,4,1
52130 REM 9 SPRITE ANIMATION RIGHT YELLOW
52130 DATA 5,5,1
52140 REM 10 SPRITE ANIMATION LEFT BLACK
52140 DATA 4,6,1
52150 REM 11 SPRITE ANIMATION LEFT YELLOW
52150 DATA 5,7,1
52160 REM SNAKE 1 ANIMATION
52160 REM 12 SPRITE ANIMATION RIGHT BLACK
52160 DATA 6,8,1
52170 REM 13 SPRITE ANIMATION RIGHT MAGENTA
52170 DATA 7,9,1
52180 REM 14 SPRITE ANIMATION LEFT BLACK
52180 DATA 6,10,1
52190 REM 15 SPRITE ANIMATION LEFT MAGENTA
52190 DATA 7,11,1
52200 REM SNAKE 2 ANIMATION
52200 REM 16 SPRITE ANIMATION RIGHT BLACK
52200 DATA 8,8,1
52210 REM 17 SPRITE ANIMATION RIGHT MAGENTA
52210 DATA 9,9,1
52220 REM 18 SPRITE ANIMATION LEFT BLACK
52220 DATA 8,10,1
52230 REM 19 SPRITE ANIMATION LEFT MAGENTA
52230 DATA 9,11,1
52240 REM BAT 1 ANIMATION
52240 REM 20 SPRITE ANIMATION BLACK
52240 DATA 10,12,1
52250 REM 21 SPRITE ANIMATION BLUE
52250 DATA 11,13,1
52260 REM BAT 2 ANIMATION
52260 REM 22 SPRITE ANIMATION BLACK
52260 DATA 12,12,1
52270 REM 23 SPRITE ANIMATION BLUE
52270 DATA 13,13,1
52280 REM 24 KEY 1
52280 DATA 14,14,1
52290 REM 25 KEY 2
52290 DATA 15,14,1
52300 REM 26 KEY 3
52300 DATA 16,14,1
52310 REM 27 KEY 4
52310 DATA 17,14,1
52320 REM 28 KEY 5
52320 DATA 18,14,1

54000 REM CHARACTER ANIMATIONS (CHARACTER NUMBER, ANIMATION DEFINITION, CYCLIC FLAG)
54000 REM TOTAL NUMBER
54000 DATA 3
54010 REM PLATFORM 29,30,31
54010 DATA 255,15,1
54020 DATA 511,15,1
54030 DATA 767,15,1